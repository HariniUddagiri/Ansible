- name: Setup mysql server
  hosts: mysql
  become: yes
  tasks:
  - name: instamm python mysql
    ansible.builtin.pip:
     name: "{{ item }}"
     executable: pip3.9
    loop:
    - PyMySQL
    - cryptography
  - name: Install mysql server
    ansible.builtin.package:
     name: mysql-server
     state: installed

  - name: Start and enable
    ansible.builtin.service:
     name: mysqld
     state: started
     enabled: yes
  
  - name: connect to server
    community.mysql.mysql_info:
     login_user: root
     login_password: ExpenseApp@1
     login_host: 172.31.91.201
    register: mysql_info
    ignore_errors: true

  - name: print output
    ansible.builtin.debug:
     msg: "output is {{ mysql_info}}"

  - name: set root password
    ansible.builtin.command: "mysql_secure_installation --set-root-pass ExpenseApp@1"
    when: mysql_info.failed is true

     
